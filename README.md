# Вступительное задание для Школы бэкенд-разработки

Yapi - python REST API сервис, который позволяет нанимать курьеров на работу,
принимать заказы и оптимально распределять заказы между курьерами, попутно считая их заработок (до рейтинга курьеров руки не дошли).

**Disclaimer:** Как и следовало ожидать в случае работы с незнакомым стеком технологий, даже трех недель не хватило для вдумчивого чтения всей документации, экспериментов с кодом, рефакторинга кода и автоматизации процесса разработки и развертывания. Фактически представленный код являет собой minimum viable product, который почти в полном объеме соответствует спецификации (очень на это надеюсь), но внутри представляет собой нечто быстро слепленное в духе спортивного программирования. В реальной жизни я никогда бы не выставил такой код на ревью, а как минимум неделю рефакторил его.

## Системные требования и основные компоненты

**Python 3.7+**
**MySQL 5.7+**

Проект реализован на фреймворке **FastAPI**, для валидации запросов используется **Pydantic**, взаимодействие с базой данных происходит посредством **SQLAlchemy Core**, за чтение конфигурационного файла отвечает **python-dotenv**. Для тестирования используется **pytest**.
В качестве сервера используется **uvicorn**, который запускается автоматически при рестарте сервера. Сам сервис управляется как служба systemd (см. *systemctl status yapi.service*), доступен по адресу 0.0.0.0:8080.

## Установка

*(Если задаться целью установить сервис заново на чистой машине, то придется делать некоторое количество ручной работы, но эта вся автоматизация, которую я могу предложить по состоянию на 29.03.2021 21:30 МСК)*

1. Устанавливаем необходимые дополнительные зависимости:
```
sudo apt install -y git build-essential python3-dev
sudo apt install -y python3-pip python3-venv
sudo apt install -y mysql-server libmysqlclient-dev
sudo mysql_secure_installation
```

2. Вручную создаем базу данных для проекта и пользователя

3. Создаем папку проекта и клонируем в нее код проекта
```
git clone https://github.com/templewood/yapi.git <project folder>
```

4. Запускаем команду make install, которая установит в питоновском виртуальном окружении необходимые пакеты, перечисленные в файле requirements.txt

5. Копируем (переименовываем) app/.env.example в app/.env и прописываем необходимые для работы с базой данных реквизиты.

6. Запускаем команду make init-db, которая создаст в базе данных необходимые таблицы. Эту же команду нужно использовать для пересоздания таблиц заново.

7. Опционально можно запустить тесты с помощью make test, чтобы убедиться, что все работает. *К сожалению, тесты пишут в ту же базу, что и сам сервис, и пересоздают все таблицы заново до и после запуска. Я знаю, что так делать нельзя, но время неумолимо приближается к полуночи, поэтому все останется так.*

8. В файле yapi.service.example содержится заготовка для unit-файла systemd, который должен быть отредактирован и вручную скопирован в /etc/systemd/system
